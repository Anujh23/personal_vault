<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Dashboard - Online</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230ea5e9' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z'/%3E%3Cpath d='m9 12 2 2 4-4'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="/src/style.css">
    <link rel="stylesheet" href="/css/reminders.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // API Configuration - Uses same origin in production
        window.API_BASE_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000'
            : ''; // Empty = same origin

        // Python Analytics Service URL
        window.PYTHON_API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:8000'
            : 'https://personal-dashboard-analytics.onrender.com';

        // Loading safeguard
        setTimeout(function () {
            const loadingScreen = document.getElementById('loadingScreen');
            const appContainer = document.getElementById('appContainer');
            if (loadingScreen && loadingScreen.style.display !== 'none') {
                console.warn('‚ö†Ô∏è Dashboard taking too long to load, forcing display');
                if (loadingScreen) loadingScreen.style.display = 'none';
                if (appContainer) appContainer.style.display = 'flex';
                document.body.style.visibility = 'visible';
            }
        }, 5000);

        window.onerror = function (msg, url, lineNo, columnNo, error) {
            console.error('JavaScript Error:', msg, 'at', url, ':', lineNo);
            return false;
        };
    </script>
</head>

<body>

    <!-- LOGIN AUTHENTICATION SCREEN -->
    <div id="loginScreen" class="login-screen" style="display: flex;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i data-lucide="shield-check" width="32" height="32"></i>
                </div>
                <h2>LifeVault</h2>
                <p>Securely manage your personal information</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="input-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" required placeholder="Enter your username"
                        autocomplete="username">
                </div>
                <div class="input-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password"
                        autocomplete="current-password">
                </div>
                <button type="submit" class="login-btn">
                    <span class="btn-text">Login</span>
                </button>
                <div id="loginMessage" class="login-message"></div>
            </form>
        </div>
    </div>

    <!-- MAIN APPLICATION WRAPPER -->
    <div id="mainApp" class="main-app" style="display: none;">
        <!-- Loading Screen -->
        <div id="loadingScreen" class="loading-screen">
            <div class="loading-spinner"></div>
            <div class="loading-text">Dashboard</div>
            <div class="loading-subtext">Loading your experience...</div>
        </div>

        <!-- Main App Container -->
        <div id="appContainer" class="app-container">

            <!-- Sidebar Navigation -->
            <aside id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <div class="app-logo">
                        <i data-lucide="database" class="logo-icon"></i>
                        <h1>LifeVault</h1>
                    </div>
                    <button id="sidebarToggle" class="sidebar-toggle" title="Toggle Sidebar">
                        <i data-lucide="panel-left-close"></i>
                    </button>
                </div>

                <nav class="sidebar-nav">
                    <!-- Main Section -->
                    <div class="nav-group">
                        <div class="nav-group-title">Main</div>
                        <a href="#" class="nav-link active" data-section="dashboard">
                            <i data-lucide="layout-dashboard" class="nav-icon"></i>
                            <span>Dashboard</span>
                        </a>
                    </div>

                    <!-- Personal Info Section -->
                    <div class="nav-group">
                        <div class="nav-group-title">Personal Info</div>
                        <a href="#" class="nav-link" data-section="personal_info">
                            <i data-lucide="user" class="nav-icon"></i>
                            <span>Personal Information</span>
                        </a>
                        <a href="#" class="nav-link" data-section="properties">
                            <i data-lucide="home" class="nav-icon"></i>
                            <span>Properties</span>
                        </a>
                        <a href="#" class="nav-link" data-section="assets">
                            <i data-lucide="gem" class="nav-icon"></i>
                            <span>Assets</span>
                        </a>
                    </div>

                    <!-- Family Info Section -->
                    <div class="nav-group">
                        <div class="nav-group-title">Family Info</div>
                        <a href="#" class="nav-link" data-section="family_members">
                            <i data-lucide="users" class="nav-icon"></i>
                            <span>Family Members</span>
                        </a>
                        <a href="#" class="nav-link" data-section="family-tree">
                            <i data-lucide="git-branch" class="nav-icon"></i>
                            <span>Family Tree</span>
                        </a>
                    </div>

                    <!-- Financial Info Section -->
                    <div class="nav-group">
                        <div class="nav-group-title">Financial Info</div>
                        <a href="#" class="nav-link" data-section="banking_details">
                            <i data-lucide="landmark" class="nav-icon"></i>
                            <span>Banking Details</span>
                        </a>
                        <a href="#" class="nav-link" data-section="income_sheet">
                            <i data-lucide="file-text" class="nav-icon"></i>
                            <span>Income Sheet</span>
                        </a>
                        <a href="#" class="nav-link" data-section="shareholdings">
                            <i data-lucide="trending-up" class="nav-icon"></i>
                            <span>Shareholdings</span>
                        </a>
                        <a href="#" class="nav-link" data-section="stocks">
                            <i data-lucide="bar-chart-3" class="nav-icon"></i>
                            <span>Stocks & Investments</span>
                        </a>
                    </div>

                    <!-- Business Info Section -->
                    <div class="nav-group">
                        <div class="nav-group-title">Business Info</div>
                        <a href="#" class="nav-link" data-section="business_info">
                            <i data-lucide="building-2" class="nav-icon"></i>
                            <span>Business Information</span>
                        </a>
                    </div>

                    <!-- Reminders Section -->
                    <div class="nav-group">
                        <div class="nav-group-title">Reminders</div>
                        <a href="#" class="nav-link" data-section="reminders">
                            <i data-lucide="bell" class="nav-icon"></i>
                            <span>All Reminders</span>
                        </a>
                        <a href="#" class="nav-link" data-section="files">
                            <i data-lucide="folder-open" class="nav-icon"></i>
                            <span>Files & Documents</span>
                        </a>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="main-container">

                <!-- Header -->
                <header class="header">
                    <div class="header-left">
                        <button id="mobileMenuBtn" class="mobile-menu-btn" title="Menu">
                            <i data-lucide="menu"></i>
                        </button>
                        <nav class="breadcrumb" id="breadcrumb">
                            <a href="#" data-section="dashboard" class="breadcrumb-item">
                                <i data-lucide="home" class="breadcrumb-icon"></i>
                                <span>Home</span>
                            </a>
                            <span class="breadcrumb-separator">/</span>
                            <span class="breadcrumb-current">Dashboard</span>
                        </nav>
                    </div>

                    <div class="header-actions">
                        <!-- Reminder Bell Icon in Header -->
                        <div id="reminder-indicators" class="reminder-indicators">
                            <div class="reminder-badge" title="Reminders">
                                <i data-lucide="bell"></i>
                                <span id="reminder-count" class="badge" style="display: none;">0</span>
                            </div>
                            <div class="reminder-list-container" id="reminder-list-container">
                                <div class="reminder-list-header">
                                    <h4>Reminders</h4>
                                    <span id="reminder-count-header">0 total</span>
                                </div>
                                <div class="reminder-list" id="reminder-list">
                                    <div class="reminder-empty">No reminders</div>
                                </div>
                            </div>
                        </div>

                        <div class="user-menu" id="userMenu">
                            <button id="userMenuBtn" class="user-menu-btn" title="User Menu">
                                <i data-lucide="user-circle"></i>
                            </button>
                            <div class="user-dropdown" id="userDropdown">
                                <div class="user-dropdown-header">
                                    <i data-lucide="user-circle" class="dropdown-user-icon"></i>
                                    <div class="user-info">
                                        <span class="user-name" id="userName">User</span>
                                        <span class="user-role" id="userRole">Logged In</span>
                                    </div>
                                </div>
                                <div class="user-dropdown-divider"></div>
                                <button class="dropdown-item" id="logoutBtn">
                                    <i data-lucide="log-out"></i>
                                    <span>Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Main Content -->
                <div class="main-content">

                    <!-- Dashboard Section -->
                    <section id="dashboard" class="section-content active">

                        <!-- Welcome Section -->
                        <div class="dashboard-welcome">
                            <div class="welcome-content">
                                <div class="welcome-header">
                                    <i data-lucide="shield-check" class="welcome-icon"></i>
                                    <h1 class="welcome-title">Welcome to LifeVault</h1>
                                    <p class="welcome-subtitle">Your secure personal information management system</p>
                                </div>
                                <div class="welcome-stats">
                                    <div class="welcome-stat">
                                        <i data-lucide="database" class="welcome-stat-icon"></i>
                                        <span class="welcome-stat-value" id="totalRecords">0</span>
                                        <span class="welcome-stat-label">Total Records</span>
                                    </div>
                                    <div class="welcome-stat">
                                        <i data-lucide="folder" class="welcome-stat-icon"></i>
                                        <span class="welcome-stat-value" id="totalFiles">0</span>
                                        <span class="welcome-stat-label">Files Stored</span>
                                    </div>
                                    <div class="welcome-stat">
                                        <i data-lucide="bell" class="welcome-stat-icon"></i>
                                        <span class="welcome-stat-value" id="activeReminders">0</span>
                                        <span class="welcome-stat-label">Active Reminders</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Statistics Grid -->
                        <div class="dashboard-grid">
                            <div class="stat-card primary" data-section="personal_info">
                                <div class="stat-header">
                                    <div class="stat-title">Personal Info</div>
                                    <i data-lucide="user" class="stat-icon"></i>
                                </div>
                                <div class="stat-value" id="personal_info_count">0</div>
                                <div class="stat-subtitle">
                                    Records
                                </div>
                            </div>

                            <div class="stat-card success" data-section="properties">
                                <div class="stat-header">
                                    <div class="stat-title">Properties</div>
                                    <i data-lucide="home" class="stat-icon"></i>
                                </div>
                                <div class="stat-value" id="properties_count">0</div>
                                <div class="stat-subtitle">
                                    Properties
                                </div>
                            </div>

                            <div class="stat-card warning" data-section="assets">
                                <div class="stat-header">
                                    <div class="stat-title">Assets</div>
                                    <i data-lucide="gem" class="stat-icon"></i>
                                </div>
                                <div class="stat-value" id="assets_count">0</div>
                                <div class="stat-subtitle">
                                    Items
                                </div>
                            </div>

                            <div class="stat-card info" data-section="banking_details">
                                <div class="stat-header">
                                    <div class="stat-title">Bank Accounts</div>
                                    <i data-lucide="building-2" class="stat-icon"></i>
                                </div>
                                <div class="stat-value" id="banking_details_count">0</div>
                                <div class="stat-subtitle">
                                    Accounts
                                </div>
                            </div>

                            <div class="stat-card primary" data-section="income_sheet">
                                <div class="stat-header">
                                    <div class="stat-title">Income Sheet</div>
                                    <i data-lucide="trending-up" class="stat-icon"></i>
                                </div>
                                <div class="stat-value" id="income_sheet_count">0</div>
                                <div class="stat-subtitle">
                                    Entries
                                </div>
                            </div>

                            <div class="stat-card primary" data-section="stocks">
                                <div class="stat-header">
                                    <div class="stat-title">Investments</div>
                                    <i data-lucide="bar-chart-2" class="stat-icon"></i>
                                </div>
                                <div class="stat-value" id="stocks_count">0</div>
                                <div class="stat-subtitle">
                                    Holdings
                                </div>
                            </div>

                            <div class="stat-card warning" data-section="family_members">
                                <div class="stat-header">
                                    <div class="stat-title">Family Members</div>
                                    <i data-lucide="users" class="stat-icon"></i>
                                </div>
                                <div class="stat-value" id="family_members_count">0</div>
                                <div class="stat-subtitle">
                                    Members
                                </div>
                            </div>

                            <div class="stat-card info" data-section="shareholdings">
                                <div class="stat-header">
                                    <div class="stat-title">Shareholding</div>
                                    <i data-lucide="pie-chart" class="stat-icon"></i>
                                </div>
                                <div class="stat-value" id="shareholdings_count">0</div>
                                <div class="stat-subtitle">
                                    Share Holdings
                                </div>
                            </div>
                        </div>

                        <!-- Dashboard Sections -->
                        <div class="dashboard-sections two-column">
                            <!-- Recent Activity Section -->
                            <div class="dashboard-section">
                                <div class="section-header">
                                    <i data-lucide="trending-up" class="section-icon"></i>
                                    <h3 class="section-title">Recent Activity</h3>
                                </div>
                                <div id="recentActivity">
                                    <div id="recentActivityList">
                                        <div class="empty-state">
                                            <i data-lucide="activity" class="empty-icon"></i>
                                            <h3>No Recent Activity</h3>
                                            <p>Start adding data to see your activity timeline</p>
                                            <button class="btn btn-primary" onclick="app.showSection('personal_info')">
                                                <span>Add Your First Record</span>
                                                <span>‚Üí</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Upcoming Reminders Section -->
                            <div class="dashboard-section">
                                <div class="section-header">
                                    <i data-lucide="bell" class="section-icon"></i>
                                    <h3 class="section-title">Upcoming Reminders</h3>
                                </div>
                                <div id="upcomingReminders">
                                    <div class="empty-state">
                                        <i data-lucide="bell-off" class="empty-icon"></i>
                                        <h3>No Upcoming Reminders</h3>
                                        <p>All your reminders are completed or in the past</p>
                                        <button class="btn btn-primary" onclick="app.showSection('reminders')">
                                            <span>Create First Reminder</span>
                                            <span>‚Üí</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Table Section (for all data tables) -->
                    <section id="tableSection" class="section-content">
                        <div class="table-header">
                            <div class="table-info">
                                <h2 id="tableTitle">Data Table</h2>
                                <p id="tableDescription">Manage your data</p>
                            </div>
                            <div class="section-actions">
                                <button id="exportBtn" class="btn btn-secondary">
                                    <i data-lucide="download"></i>
                                    <span>Export</span>
                                </button>
                                <button id="importBtn" class="btn btn-secondary">
                                    <i data-lucide="upload"></i>
                                    <span>Import</span>
                                </button>
                                <button id="addRecordBtn" class="btn btn-primary">
                                    <i data-lucide="plus"></i>
                                    <span>Add New</span>
                                </button>
                            </div>
                        </div>

                        <div class="table-controls">
                            <div class="table-search">
                                <input type="text" id="tableSearch" class="search-input"
                                    placeholder="Search in table...">
                                <i data-lucide="search" class="search-icon"></i>
                            </div>
                            <div class="table-filters">
                                <!-- Filters can be added here dynamically -->
                            </div>
                        </div>

                        <!-- Optional chart area for specific tables (e.g., Shareholdings) -->
                        <div id="tableChartContainer" class="table-chart-container" style="display: none;"></div>

                        <div class="table-container">
                            <table class="data-table">
                                <thead id="tableHead">
                                    <tr>
                                        <th>Loading...</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                    <tr>
                                        <td>Loading data...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="pagination">
                            <div id="paginationInfo" class="pagination-info">Showing 0 records</div>
                            <div class="pagination-controls">
                                <button id="firstPage" class="pagination-btn">¬´</button>
                                <button id="prevPage" class="pagination-btn">‚Äπ</button>
                                <div id="paginationPages" class="pagination-pages"></div>
                                <button id="nextPage" class="pagination-btn">‚Ä∫</button>
                                <button id="lastPage" class="pagination-btn">¬ª</button>
                            </div>
                        </div>

                        <div id="emptyState" class="empty-state" style="display: none;">
                            <div class="empty-icon">üìù</div>
                            <h3>No Records Found</h3>
                            <p>Start by adding your first record to this section</p>
                            <button class="btn btn-primary" onclick="app.showRecordForm()">
                                <span>‚ûï</span>
                                <span>Add First Record</span>
                            </button>
                        </div>
                    </section>

                    <!-- Family Tree Section -->
                    <section id="familyTreeSection" class="section-content family-tree-section">
                        <!-- Content will be generated by JavaScript -->
                    </section>

                </div>
            </main>
        </div>

        <!-- Floating Action Button -->
        <div class="fab-container">
            <button id="fabBtn" class="fab-btn" title="Quick Add">
                <i data-lucide="plus"></i>
            </button>
            <div class="fab-menu" id="fabMenu">
                <button class="fab-item" data-action="add-personal" title="Add Personal Info">
                    <i data-lucide="user"></i>
                    <span>Personal</span>
                </button>
                <button class="fab-item" data-action="add-family" title="Add Family Member">
                    <i data-lucide="users"></i>
                    <span>Family</span>
                </button>
                <button class="fab-item" data-action="add-property" title="Add Property">
                    <i data-lucide="home"></i>
                    <span>Property</span>
                </button>
                <button class="fab-item" data-action="add-reminder" title="Set Reminder">
                    <i data-lucide="bell"></i>
                    <span>Reminder</span>
                </button>
            </div>
        </div>

        <!-- Keyboard Shortcuts Modal -->
        <div id="shortcutsModal" class="shortcuts-modal">
            <div class="shortcuts-content">
                <div class="shortcuts-header">
                    <h3>Keyboard Shortcuts</h3>
                    <button id="closeShortcuts" class="modal-close">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div class="shortcuts-body">
                    <div class="shortcut-group">
                        <h4>General</h4>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>?</kbd></span>
                            <span class="shortcut-desc">Show keyboard shortcuts</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>‚åò</kbd> <kbd>B</kbd></span>
                            <span class="shortcut-desc">Toggle sidebar</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>‚åò</kbd> <kbd>T</kbd></span>
                            <span class="shortcut-desc">Toggle theme</span>
                        </div>
                    </div>
                    <div class="shortcut-group">
                        <h4>Navigation</h4>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>g</kbd> <kbd>h</kbd></span>
                            <span class="shortcut-desc">Go to Home</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>g</kbd> <kbd>p</kbd></span>
                            <span class="shortcut-desc">Go to Personal Info</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>g</kbd> <kbd>f</kbd></span>
                            <span class="shortcut-desc">Go to Family</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>g</kbd> <kbd>r</kbd></span>
                            <span class="shortcut-desc">Go to Reminders</span>
                        </div>
                    </div>
                    <div class="shortcut-group">
                        <h4>Actions</h4>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>n</kbd></span>
                            <span class="shortcut-desc">New record</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>‚åò</kbd> <kbd>‚Üµ</kbd></span>
                            <span class="shortcut-desc">Save form</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-keys"><kbd>esc</kbd></span>
                            <span class="shortcut-desc">Close modal / Cancel</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Record Form Modal -->
        <div id="modalOverlay" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3 id="modalTitle">Add Record</h3>
                    <button id="modalClose" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="recordForm" class="record-form">
                        <div id="formFields" class="form-grid">
                            <!-- Form fields will be generated dynamically -->
                        </div>

                        <!-- File Upload Section -->
                        <div class="file-upload-section">
                            <div class="file-upload-header">
                                <h4>üìé File Attachments</h4>
                                <small>Upload documents, images, and other files related to this record</small>
                            </div>

                            <div id="fileDropZone" class="file-drop-zone">
                                <span class="upload-icon">üìÅ</span>
                                <h4>Drop files here or click to browse</h4>
                                <p>Support for PDF, DOC, XLS, images and more</p>
                                <div class="upload-formats">
                                    <small>Supported: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF (Max: 10MB each)</small>
                                </div>
                            </div>

                            <input type="file" id="fileInput" class="file-input" multiple
                                accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.webp,.txt,.csv">

                            <div id="uploadedFiles" class="uploaded-files">
                                <div class="files-list" id="filesList">
                                    <!-- Uploaded files will appear here -->
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="cancelBtn" class="btn btn-secondary">
                        <span>Cancel</span>
                    </button>
                    <button type="submit" id="saveBtn" class="btn btn-primary" form="recordForm">
                        <span id="saveBtnText">Save Record</span>
                        <span>üíæ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- File Preview Modal -->
        <div id="filePreviewModal" class="modal-overlay">
            <div class="modal file-preview-modal">
                <div class="modal-header">
                    <h3 id="filePreviewTitle">File Preview</h3>
                    <button id="filePreviewClose" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="filePreviewContent">
                        <!-- Preview content will be inserted here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="filePreviewDownload" class="btn btn-primary">
                        <span>Download File</span>
                        <span>üì•</span>
                    </button>
                    <button type="button" id="filePreviewCloseBtn" class="btn btn-secondary">
                        <span>Close</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmModalOverlay" class="modal-overlay">
            <div class="modal confirmation-modal">
                <div class="modal-header">
                    <h3 id="confirmTitle">Confirm Action</h3>
                </div>
                <div class="modal-body">
                    <p id="confirmMessage">Are you sure you want to proceed?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="confirmCancel" class="btn btn-secondary">Cancel</button>
                    <button type="button" id="confirmOk" class="btn btn-success">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container">
            <!-- Toast notifications will appear here -->
        </div>

        <!-- Hidden Import File Input -->
        <input type="file" id="importFileInput" accept=".json,.csv" style="display: none;">

        <!-- Scripts -->
        <script src="/src/app.js" type="module"></script>

        <!-- Reminder Components -->
        <script src="/js/components/reminderIndicators.js"></script>

        <!-- Initialize Lucide Icons -->
        <script>
            lucide.createIcons();
        </script>

        <script>
            // Initialize Lucide icons
            lucide.createIcons();

            // Re-initialize icons after DOM updates
            window.refreshIcons = function () {
                lucide.createIcons();
            };

            // ========================================
            // NEW UI FEATURES - Enhanced Interactions
            // ========================================

            // Collapsible Sidebar
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const mainContainer = document.querySelector('.main-container');

            sidebarToggle?.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
                localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
                refreshIcons();
            });

            // Restore sidebar state
            if (localStorage.getItem('sidebarCollapsed') === 'true') {
                sidebar?.classList.add('collapsed');
            }

            // Mobile menu toggle
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            mobileMenuBtn?.addEventListener('click', () => {
                sidebar?.classList.toggle('active');
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 1024 &&
                    !sidebar?.contains(e.target) &&
                    !mobileMenuBtn?.contains(e.target)) {
                    sidebar?.classList.remove('active');
                }
            });

            // Floating Action Button
            const fabContainer = document.querySelector('.fab-container');
            const fabBtn = document.getElementById('fabBtn');
            const fabItems = document.querySelectorAll('.fab-item');

            fabBtn?.addEventListener('click', () => {
                fabContainer?.classList.toggle('active');
                fabBtn?.classList.toggle('active');
            });

            // Close FAB menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!fabContainer?.contains(e.target)) {
                    fabContainer?.classList.remove('active');
                    fabBtn?.classList.remove('active');
                }
            });

            // FAB item actions
            fabItems.forEach(item => {
                item.addEventListener('click', () => {
                    const action = item.dataset.action;
                    if (action && window.app) {
                        switch (action) {
                            case 'add-personal':
                                window.app.showSection('personal_info');
                                window.app.showRecordForm();
                                break;
                            case 'add-family':
                                window.app.showSection('family_members');
                                window.app.showRecordForm();
                                break;
                            case 'add-property':
                                window.app.showSection('properties');
                                window.app.showRecordForm();
                                break;
                            case 'add-reminder':
                                window.app.showSection('reminders');
                                window.app.showRecordForm();
                                break;
                        }
                    }
                    fabContainer?.classList.remove('active');
                    fabBtn?.classList.remove('active');
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Cmd/Ctrl + B for sidebar
                if ((e.metaKey || e.ctrlKey) && e.key === 'b') {
                    e.preventDefault();
                    sidebarToggle?.click();
                }

                // ? for keyboard shortcuts
                if (e.key === '?' && !e.metaKey && !e.ctrlKey && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                    document.getElementById('shortcutsModal')?.classList.add('active');
                }

                // ESC to close modals
                if (e.key === 'Escape') {
                    document.getElementById('shortcutsModal')?.classList.remove('active');
                }

                // n for new record
                if (e.key === 'n' && !e.metaKey && !e.ctrlKey && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                    window.app?.showRecordForm();
                }

                // g + letter for navigation
                if (e.key === 'g' && !e.metaKey && !e.ctrlKey && e.target.tagName !== 'INPUT') {
                    const navKeys = {
                        'h': 'dashboard',
                        'p': 'personal_info',
                        'f': 'family_members',
                        'r': 'reminders',
                        'b': 'banking_details',
                        's': 'stocks',
                        'a': 'assets',
                        'o': 'properties'
                    };

                    const handler = (navEvent) => {
                        const section = navKeys[navEvent.key];
                        if (section && window.app) {
                            navEvent.preventDefault();
                            window.app.showSection(section);
                            document.removeEventListener('keydown', handler);
                        }
                    };

                    document.addEventListener('keydown', handler);
                    setTimeout(() => document.removeEventListener('keydown', handler), 1000);
                }
            });

            // Keyboard Shortcuts Modal
            const shortcutsModal = document.getElementById('shortcutsModal');
            const keyboardShortcutsBtn = document.getElementById('keyboardShortcutsBtn');
            const closeShortcuts = document.getElementById('closeShortcuts');

            keyboardShortcutsBtn?.addEventListener('click', () => {
                shortcutsModal?.classList.add('active');
            });

            closeShortcuts?.addEventListener('click', () => {
                shortcutsModal?.classList.remove('active');
            });

            shortcutsModal?.addEventListener('click', (e) => {
                if (e.target === shortcutsModal) shortcutsModal.classList.remove('active');
            });

            // Breadcrumb update helper
            window.updateBreadcrumb = function (section, title) {
                const breadcrumbCurrent = document.querySelector('.breadcrumb-current');
                if (breadcrumbCurrent && title) {
                    breadcrumbCurrent.textContent = title;
                }
            };

            // User Menu Dropdown
            const userMenu = document.getElementById('userMenu');
            const userMenuBtn = document.getElementById('userMenuBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userName = document.getElementById('userName');

            // Update username from auth
            if (window.dashboardAuth?.currentUser?.username) {
                userName.textContent = window.dashboardAuth.currentUser.username;
            }

            userMenuBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                userMenu?.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!userMenu?.contains(e.target)) {
                    userMenu?.classList.remove('active');
                }
            });

            // Logout button handler
            logoutBtn?.addEventListener('click', () => {
                logout();
                userMenu?.classList.remove('active');
            });

            // Add ripple effect to buttons
            document.querySelectorAll('.btn, .nav-link, .fab-btn, .fab-item, .dropdown-item').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    const rect = this.getBoundingClientRect();
                    const ripple = document.createElement('span');
                    ripple.style.cssText = `
                        position: absolute;
                        background: rgba(255,255,255,0.3);
                        border-radius: 50%;
                        transform: scale(0);
                        animation: ripple 0.6s linear;
                        pointer-events: none;
                    `;
                    const size = Math.max(rect.width, rect.height);
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = e.clientX - rect.left - size / 2 + 'px';
                    ripple.style.top = e.clientY - rect.top - size / 2 + 'px';
                    this.style.position = 'relative';
                    this.style.overflow = 'hidden';
                    this.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 600);
                });
            });

            // Add ripple animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);

            console.log('Enhanced UI features loaded');
        </script>

    </div>
</body>

</html>